{% autoescape None %}
<!DOCTYPE html>
<html>

<head>

<script type="text/javascript" src="/static/js/rockerbox/helper.js"></script>
<title>Rockerbox - Create Advertiser</title>

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<link rel="icon" type="image/png" href="https://s3.amazonaws.com/getrockerbox.com/Fav_icon.png">
<link href='http://rockerbox.com/styles/fonts.css' type='text/css' rel='stylesheet' media="screen">
<link href="http://rockerbox.com/styles/login-style.css" type="text/css" rel="stylesheet" media="screen">
<link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic,700,700italic,800,800italic%7CUbuntu:300,300italic,400,400italic,500,500italic,700,700italic%7CInconsolata:400,400italic,700,700italic%7CLato:100,100italic,300,300italic,400,400italic,700,700italic,900,900italic">
<link type="text/css" rel="stylesheet" href="/static/css/bootstrap.css"/>
<link type="text/css" rel="stylesheet" href="/static/css/bootstrap.min.css"/>
<link type="text/css" rel="stylesheet" href="/static/css/style.css"/>

<style>
  .hidden {display:none}
  body {padding-top:0px}
  body > .container {margin-left:0px}
  .window_content {text-align: left}
</style>

<script type="text/javascript" src="/static/js/d3.js" charset="utf-8"></script>
<script src="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.7/highlight.min.js"></script>
<script type="text/javascript" src="/static/js/rockerbox/crusher/start/build/start.js"></script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-50457693-1', 'rockerbox.com');
  ga('require', 'displayfeatures');
  ga('send', 'pageview');
</script>
<script type="text/javascript">
  (function(f,b){if(!b.__SV){var a,e,i,g;window.mixpanel=b;b._i=[];b.init=function(a,e,d){function f(b,h){var a=h.split(".");2==a.length&&(b=b[a[0]],h=a[1]);b[h]=function(){b.push([h].concat(Array.prototype.slice.call(arguments,0)))}}var c=b;"undefined"!==typeof d?c=b[d]=[]:d="mixpanel";c.people=c.people||[];c.toString=function(b){var a="mixpanel";"mixpanel"!==d&&(a+="."+d);b||(a+=" (stub)");return a};c.people.toString=function(){return c.toString(1)+".people (stub)"};i="disable track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config people.set people.set_once people.increment people.append people.track_charge people.clear_charges people.delete_user".split(" "); for(g=0;g<i.length;g++)f(c,i[g]);b._i.push([a,e,d])};b.__SV=1.2;a=f.createElement("script");a.type="text/javascript";a.async=!0;a.src="//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js";e=f.getElementsByTagName("script")[0];e.parentNode.insertBefore(a,e)}})(document,window.mixpanel||[]); mixpanel.init("aa0178efc52a2d246ee37d8d1df5e31c");
</script>




</head>
<body class="create" >
  <div class="container" style="width:inherit">
    <div class="row funnels"></div>
  </div>
</body>

<script>

d3.json("/account/permissions")
  .get(function(err,x){

      var s = window.location.search;
      var nonce = (s.indexOf("nonce") > -1 ) ?
        s.split("nonce=")[1].split("&")[0] : 
        "";

      var slide_position = !!nonce ? 
        3 : (!!err) ? 
        0 : (x.results.advertisers[0].external_advertiser_id == 0) ?
        1 : 2;
          
    
      var funcs = [
          function(x,pane) {
            var email = pane.selectAll(".envelope_description input").node().value
            var split = email.split("@")
            
            if ( !((split.length > 1) && (split[0].length > 0) && (split[1].length > 3)) ) return pane.selectAll(".message").text("Email address is not valid.")
            
            var obj = { "username": email, "email": email }
            console.log(obj)
            d3.xhr("/signup")
              .post(JSON.stringify(obj),function(err,x) {
                if (!err) return slideshow.next()
                return pane.selectAll(".message").text("Error: " + JSON.parse(err.response).error)
              })
    
          }
        , function(x,pane) {
    
            var domain = pane.selectAll(".envelope_description input").node().value
            domain = domain.replace("http://","").replace("https://","").replace("www.","")
            var split = domain.split(".")
            var pixel_source_name = split.slice(0,-1).join("")
            
            if ( !((split.length > 1) && (split[0].length > 2) && (split[1].length > 1)) ) return pane.selectAll(".message").text("Domain name is not valid.")
    
            // get the advertiser and create advertiser / pixels
            var obj = { "client_sld": domain, "pixel_source_name": pixel_source_name, "advertiser_name": pixel_source_name }
            console.log(obj)
            pane.selectAll(".message").text("Advertiser being created...")

            d3.xhr("/advertiser")
              .post(JSON.stringify(obj),function(err,x) {
                var advertiser_obj = JSON.parse(x.response)
                
                pane.selectAll(".message").text("Pixels being created...")
                d3.xhr("/pixel")
                  .post(JSON.stringify({"segment_name": "All Pages", "segment_type":"segment"}), function(err,x){
pane.selectAll(".message").text("Pixels being created.")

                    d3.xhr("/pixel")
                      .post(JSON.stringify({"segment_name": "Signup", "segment_type":"conversion"}), function(err,x){
pane.selectAll(".message").text("Pixels being created..")

                        d3.xhr("/pixel")
                          .post(JSON.stringify({"segment_name": "Purchase", "segment_type":"conversion"}), function(err,x){
pane.selectAll(".message").text("Pixels being created...")

                            d3.xhr("/pixel")
                              .post(JSON.stringify({"segment_name": "Logged In", "segment_type":"segment"}), function(err,x){
pane.selectAll(".message").text("Success!")

                                slideshow.next()
                              })
                          })
                      })
                  })

                
                

                if (false) slideshow.next()
              })
    
          }
        , function(x,pane) {
            slideshow.next()
          }
        , function(x,pane) {
            var password = pane.selectAll(".envelope_description input").node().value
            if ( !(password.length > 5) ) return pane.selectAll(".message").text("Password length is too short.")
           
            var obj = { "password": password, "nonce":nonce}
            d3.xhr("/signup")
              .send("PUT", JSON.stringify(obj), function(err,x){
                if (!err) document.location = "/crusher"
                pane.selectAll(".message").text(JSON.parse(err.response).error)
    
              })
    
          }
      ]
    
      var slides = [
        function slide1(){
          var d = d3.select(this)                                                                                    
    
          var stage = start.stage(d)
            .title("Getting Started")                                                                                
            .subtitle("Setup is easy and takes less than two minutes. Enter your email to get started. ")
            .left("")
            .right("")                                                                                               
            .draw()                                                                                                  
          
          var cp_row = stage._stage                                                                                  
          
          var env = start.envelope(cp_row)
            .data([])
            .title("What's your email?")
            .description("")
            .button("next")
            .click(funcs[0])
            .draw()
    
          var row = d3_updateable(env._desc_wrapper,".row","div")
            .classed("row",true)
    
          d3_updateable(row,"input","input")
            .attr("placeholder","email")
            .style("width","300px")
    
          d3_updateable(row,".message","div")
            .classed("message",true)
    
    
          cp_row.selectAll(".envelope")
            .style("margin-bottom","0px")
    
          cp_row.selectAll("h3")
            .style("margin-bottom","0px")
    
          cp_row.selectAll(".envelope_description")
            .style("margin-bottom","-20px")
    
    
    
        } 
      , function slide2(){
          var d = d3.select(this)
            
          var stage = start.stage(d)
            .title("Let's get started!")                                                                                
            .subtitle("To get started, tell us on what domain will we be implementing pixels?")
            .left("")
            .right("")                                                                                               
            .draw()                                                                                                  
          
          var current = 0;
    
          stage
            .left("<div class='codepeek_text'>Knowing the domain for the website will help us setup your account.</div>")
            .right("<div class='codepeek_text'>We will also use your domain to help check the pixel is implemented correctly.</div>")                                                                         
            .draw()                                                                                                
    
          var env = start.envelope(stage._stage)
            .data([])
            .title("What's your domain?")
            .description("")
            .button("next")
            .click(funcs[1])
            .draw()
          
          var row = d3_updateable(env._desc_wrapper,".row","div")
            .classed("row",true)
    
          d3_updateable(row,"input","input")
            .attr("placeholder","example.com")
            .style("width","300px")
    
          stage._stage.selectAll(".envelope")
            .style("margin-bottom","0px")
    
          stage._stage.selectAll("h3")
            .style("margin-bottom","0px")
    
          stage._stage.selectAll(".envelope_description")
            .style("margin-bottom","-20px")
    
    
    
          
        }                                                                                                            
      , function slide3(){
          
          var d = d3.select(this)
          var stage = start.stage(d)
            .title("Almost there!")                                                                                
            .subtitle("Paste the code below before the </head> tag on every page of your site.")
            .left("<div class='codepeek_text'>This pixel allows us to collect a pool of data about the users in your audience. <br><br> </div>")
            .right("<div class='codepeek_text'>After the pixel is implemented, you will receive the Hindsight Daily Digest. <br><br> It will show content you should engage with and recommend stories that matches your audience.</div>")
            .draw()
        
          var cp_row = stage._stage
          d3.json("/pixel?implementation=hindsight")
            .get(function(err,j){
              var click = function(){}//home.codepeek_click(cp_row,advertiser,uid,slideshow.next.bind(slideshow))
            
              var advertiser = { "segments":j.segment_pixels.map(function(s){ s.segment_implemented = s.compiled; return s}) }
        
              start.codepeek(cp_row)
                .data(advertiser)
                .button("check")
                .click(click)
                .draw()

            })

    
    
        }
      , function slide4(){
          var d = d3.select(this)                                                                                    
    
          var stage = start.stage(d)
            .title("Activate Account")                                                                                
            .subtitle("Choose a password to complete account activation.")
            .left("")
            .right("")                                                                                               
            .draw()                                                                                                  
          
          var cp_row = stage._stage                                                                                  
          
          var env = start.envelope(cp_row)
            .data([])
            .title("Choose a password")
            .description("")
            .button("activate")
            .click(funcs[3])
            .draw()
    
          var row = d3_updateable(env._desc_wrapper,".row","div")
            .classed("row",true)
    
          d3_updateable(row,"input","input")
            .attr("type","password")
            .attr("placeholder","password")
            .style("width","300px")
    
          d3_updateable(row,".message","div")
            .classed("message",true)
    
    
          cp_row.selectAll(".envelope")
            .style("margin-bottom","0px")
    
          cp_row.selectAll("h3")
            .style("margin-bottom","0px")
    
          cp_row.selectAll(".envelope_description")
            .style("margin-bottom","-20px")
    
    
    
        }
      ]                                                                                                                

      slides = slides.slice(slide_position)
                                                                     
    
     
    
    var slideshow = start.slideshow(d3.select(".funnels"))
      .data(slides)
      .draw()
    
    slideshow
      .slides()
      .each(function(x,i){
        return x.bind(this)(x,i)
      })



})





</script>

</html>
