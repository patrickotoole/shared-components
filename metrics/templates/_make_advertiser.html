{% autoescape None %}
<!DOCTYPE html>
<html>

<head>

<script type="text/javascript" src="/static/js/rockerbox/helper.js"></script>
<title>Rockerbox - Create Advertiser</title>

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<link rel="icon" type="image/png" href="https://s3.amazonaws.com/getrockerbox.com/Fav_icon.png">

<link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic,700,700italic,800,800italic%7CUbuntu:300,300italic,400,400italic,500,500italic,700,700italic%7CInconsolata:400,400italic,700,700italic%7CLato:100,100italic,300,300italic,400,400italic,700,700italic,900,900italic">

<link type="text/css" rel="stylesheet" href="/static/css/bootstrap.min.css"/>
<link type="text/css" rel="stylesheet" href="/static/css/style.css"/>

<style>
  .hidden {display:none}
  body {padding-top:0px}
  body > .container {margin-left:0px}
  .window_content {text-align: left}
</style>

<script type="text/javascript" src="/static/js/d3.js" charset="utf-8"></script>
<script src="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.7/highlight.min.js"></script>
<script type="text/javascript" src="/static/js/rockerbox/crusher/start/build/start.js"></script>
<script type="text/javascript" src="/static/js/rockerbox/crusher/signup/build/signup.js"></script>
<script type="text/javascript" src="/static/js/queue.js"></script>



<script type="text/javascript" src="/static/js/analytics.js"></script>

<script type="text/javascript">
  window.analytics.google()
  window.analytics.mixpanel()
</script>


</head>
<body class="create" style="background:#40495c">
  <img src="/static/img/general/hindsight.png" style="padding:10px;height:50px;margin-left:10px;display:block;margin-bottom:-5px" />
  <div class="container" style="width:inherit">
    <div class="row funnels"></div>
  </div>
</body>

<script>
//signup.signup(d3.select(".funnels"))
//  .data({})
//  .draw()
//
//if (false) 
d3.json("/account/permissions")
  .get(function(err,x){

      var s = window.location.search;
      var nonce = (s.indexOf("nonce") > -1 ) ?
        s.split("nonce=")[1].split("&")[0] : 
        "";

      var slide_position = !!nonce ? 
        3 : (!!err) ? 
        0 : (x.results.advertisers[0].external_advertiser_id == 0) ?
        1 : 2;

          
    
      var funcs = [ 0 , 1 , 2
        , function(x,pane) {
            var password = pane.selectAll(".envelope_description input").node().value
            if ( !(password.length > 5) ) return pane.selectAll(".message").text("Password length is too short.")
           
            var obj = { "password": password, "nonce":nonce}
            d3.xhr("/signup")
              .send("PUT", JSON.stringify(obj), function(err,x){
                if (!err) document.location = "/crusher"
                pane.selectAll(".message").text(JSON.parse(err.response).error)
    
              })
    
          }
      ]
    
      var slides = [
        function slide1(){
          var d = d3.select(this)                                                                                    
    
          signup.email(d)
            .on("success",function(){slideshow.next()})
            .draw()
    
        } 
      , function slide2(){
          var d = d3.select(this)
            
          signup.domain(d)
            .on("success",function(){slideshow.next()})
            .draw()
          
        }                                                                                                            
      , function slide3(){

          var d = d3.select(this)
          
          signup.pixel(d)
            .on("success",function(){document.location = "/crusher"})
            .draw();
    
        }
      , function slide4(){
    
          var d = d3.select(this)
          
          signup.password(d)
            .data({"nonce":nonce})
            .on("success",function(){document.location = "/crusher"})
            .draw();

    
    
    
        }
      ]                                                                                                                

      slides = slides.slice(slide_position)
                                                                     
    
     
    
    var slideshow = start.slideshow(d3.select(".funnels"))
      .data(slides)
      .draw()
    
})





</script>

</html>
