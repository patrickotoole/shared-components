From 803a5e16336f189695e4eb6affa10efce9c161d5 Mon Sep 17 00:00:00 2001
From: Mike Percy <mpercy@cloudera.com>
Date: Wed, 8 Aug 2012 23:00:54 -0700
Subject: [PATCH 01/56] CLOUDERA-BUILD. Cloudera build system base tweaks.

---
 flume-ng-dist/src/main/assembly/bin.xml |    1 +
 flume-ng-dist/src/main/assembly/src.xml |    1 +
 pom.xml                                 |   62 ++++++++++++++++++++++++++++---
 3 files changed, 58 insertions(+), 6 deletions(-)

diff --git a/flume-ng-dist/src/main/assembly/bin.xml b/flume-ng-dist/src/main/assembly/bin.xml
index 5aa7cc6..c098d85 100644
--- a/flume-ng-dist/src/main/assembly/bin.xml
+++ b/flume-ng-dist/src/main/assembly/bin.xml
@@ -84,6 +84,7 @@
         <include>RELEASE-NOTES</include>
         <include>bin/**</include>
         <include>conf/**</include>
+        <include>cloudera/**</include>
       </includes>
     </fileSet>
 
diff --git a/flume-ng-dist/src/main/assembly/src.xml b/flume-ng-dist/src/main/assembly/src.xml
index dc8b92b..6b0a87d 100644
--- a/flume-ng-dist/src/main/assembly/src.xml
+++ b/flume-ng-dist/src/main/assembly/src.xml
@@ -110,6 +110,7 @@
         <include>bin/**</include>
         <include>conf/**</include>
         <include>pom.xml</include>
+        <include>cloudera/**</include>
         <include>flume-ng-doc/**</include>
         <include>flume-ng-tests/**</include>
       </includes>
diff --git a/pom.xml b/pom.xml
index 793585d..8160953 100644
--- a/pom.xml
+++ b/pom.xml
@@ -19,9 +19,9 @@ limitations under the License.
   xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
 
   <parent>
-    <groupId>org.apache</groupId>
-    <artifactId>apache</artifactId>
-    <version>9</version>
+    <groupId>com.cloudera.cdh</groupId>
+    <artifactId>cdh-root</artifactId>
+    <version>4.4.0-SNAPSHOT</version>
   </parent>
 
   <modelVersion>4.0.0</modelVersion>
@@ -87,6 +87,12 @@ limitations under the License.
             <groupId>org.apache.hadoop</groupId>
             <artifactId>${hadoop.common.artifact.id}</artifactId>
             <version>${hadoop.version}</version>
+            <exclusions>
+              <exclusion>
+                <groupId>com.cloudera.cdh</groupId>
+                <artifactId>hadoop-ant</artifactId>
+              </exclusion>
+            </exclusions>
           </dependency>
           <dependency>
             <groupId>org.apache.hadoop</groupId>
@@ -106,8 +112,8 @@ limitations under the License.
         </property>
       </activation>
       <properties>
-        <hadoop.version>2.0.0-alpha</hadoop.version>
-        <hbase.version>0.94.2</hbase.version>
+        <hadoop.version>${cdh.hadoop.version}</hadoop.version>
+        <hbase.version>${cdh.hbase.version}</hbase.version>
         <hadoop.common.artifact.id>hadoop-common</hadoop.common.artifact.id>
         <thrift.version>0.8.0</thrift.version>
       </properties>
@@ -143,6 +149,12 @@ limitations under the License.
             <artifactId>hadoop-auth</artifactId>
             <version>${hadoop.version}</version>
           </dependency>
+          <dependency>
+            <groupId>org.apache.hadoop</groupId>
+            <artifactId>hadoop-minicluster</artifactId>
+            <version>${hadoop.version}</version>
+            <scope>test</scope>
+          </dependency>
         </dependencies>
       </dependencyManagement>
     </profile>
@@ -448,6 +460,27 @@ limitations under the License.
   </pluginRepositories>
 
   <repositories>
+     <repository>
+      <id>cdh.repo</id>
+      <url>https://repository.cloudera.com/artifactory/cloudera-repos</url>
+      <name>Cloudera Repositories</name>
+      <snapshots>
+        <enabled>false</enabled>
+      </snapshots>
+    </repository>
+    
+    <repository>
+      <id>cdh.snapshots.repo</id>
+      <url>https://repository.cloudera.com/artifactory/libs-snapshot-local</url>
+      <name>Cloudera Snapshots Repository</name>
+      <snapshots>
+        <enabled>true</enabled>
+      </snapshots>
+      <releases>
+        <enabled>false</enabled>
+      </releases>
+    </repository>
+
     <repository>
       <id>repo1.maven.org</id>
       <url>http://repo1.maven.org/maven2</url>
@@ -471,11 +504,13 @@ limitations under the License.
   </repositories>
 
   <distributionManagement>
+    <!--
     <repository>
       <id>apache.staging.https</id>
       <name>Apache Staging Repository</name>
       <url>https://repository.apache.org/service/local/staging/deploy/maven2/</url>
     </repository>
+    -->
     <site>
       <id>apache.website</id>
       <url>${siteUrlDeployment}</url>
@@ -548,6 +583,9 @@ limitations under the License.
                   <exclude>.repository/</exclude>
                   <exclude>**/*.diff</exclude>
                   <exclude>**/*.patch</exclude>
+                  <exclude>cloudera/*</exclude>
+                  <!-- Exclude buildinfo files from RAT, since they're only used for CDH unit test aggregation. -->
+                  <exclude>*buildinfo</exclude>
                   <exclude>**/*.avsc</exclude>
                   <exclude>**/*.avro</exclude>
                   <exclude>**/docs/**</exclude>
@@ -666,7 +704,7 @@ limitations under the License.
       <dependency>
         <groupId>com.google.guava</groupId>
         <artifactId>guava</artifactId>
-        <version>10.0.1</version>
+        <version>11.0.2</version>
       </dependency>
 
       <dependency>
@@ -845,6 +883,12 @@ limitations under the License.
         <groupId>org.apache.hbase</groupId>
         <artifactId>hbase</artifactId>
         <version>${hbase.version}</version>
+        <exclusions>
+          <exclusion>
+            <groupId>com.cloudera.cdh</groupId>
+            <artifactId>zookeeper-ant</artifactId>
+          </exclusion>
+        </exclusions>
       </dependency>
 
       <dependency>
@@ -853,6 +897,12 @@ limitations under the License.
         <version>${hbase.version}</version>
         <classifier>tests</classifier>
         <scope>test</scope>
+        <exclusions>
+          <exclusion>
+            <groupId>com.cloudera.cdh</groupId>
+            <artifactId>zookeeper-ant</artifactId>
+          </exclusion>
+        </exclusions>
       </dependency>
 
       <dependency>
-- 
1.7.0.4

