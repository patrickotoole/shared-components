From f5b9e021d8b4befe2a79d866c8e6bd4f6fc4bf8e Mon Sep 17 00:00:00 2001
From: Hari Shreedharan <hshreedharan@apache.org>
Date: Wed, 14 Aug 2013 18:23:51 -0700
Subject: [PATCH 25/56] FLUME-2161. Flume does not support spaces in -X java-opt command line args

(Mike Percy via Hari Shreedharan)
---
 bin/flume-ng |   16 +++++++---------
 1 files changed, 7 insertions(+), 9 deletions(-)

diff --git a/bin/flume-ng b/bin/flume-ng
index 65cc985..3a8a10d 100755
--- a/bin/flume-ng
+++ b/bin/flume-ng
@@ -224,7 +224,7 @@ run_flume() {
   if [ ${CLEAN_FLAG} -ne 0 ]; then
     set -x
   fi
-  $EXEC $JAVA_HOME/bin/java $JAVA_OPTS -cp "$FLUME_CLASSPATH" \
+  $EXEC $JAVA_HOME/bin/java $JAVA_OPTS "${arr_java_props[@]}" -cp "$FLUME_CLASSPATH" \
       -Djava.library.path=$FLUME_JAVA_LIBRARY_PATH "$FLUME_APPLICATION_CLASS" $*
 }
 
@@ -241,7 +241,8 @@ LD_LIBRARY_PATH=""
 opt_conf=""
 opt_classpath=""
 opt_plugins_dirs=""
-opt_java_props=""
+arr_java_props=()
+arr_java_props_ct=0
 opt_dryrun=""
 
 mode=$1
@@ -301,10 +302,12 @@ while [ -n "$*" ] ; do
       shift
       ;;
     -D*)
-      opt_java_props="$opt_java_props $arg"
+      arr_java_props[arr_java_props_ct]=$arg
+      ((++arr_java_props_ct))
       ;;
     -X*)
-      opt_java_props="$opt_java_props $arg"
+      arr_java_props[arr_java_props_ct]=$arg
+      ((++arr_java_props_ct))
       ;;
     *)
       args="$args $arg"
@@ -325,11 +328,6 @@ elif [ -f "$opt_conf/flume-env.sh" ]; then
   source "$opt_conf/flume-env.sh"
 fi
 
-# append command-line java options to stock or env script JAVA_OPTS
-if [ -n "${opt_java_props}" ]; then
-  JAVA_OPTS="${JAVA_OPTS} ${opt_java_props}"
-fi
-
 # prepend command-line classpath to env script classpath
 if [ -n "${opt_classpath}" ]; then
   if [ -n "${FLUME_CLASSPATH}" ]; then
-- 
1.7.0.4

