{% autoescape None %}
<head>
  <style>
    .hidden { display:none }
    .label { display:inline-block; width:150px }
    .field { display:inline-block; width:200px }

  </style>
  <script data-require="d3@3.5.3" data-semver="3.5.3" src="//cdnjs.cloudflare.com/ajax/libs/d3/3.5.3/d3.js"></script>

  <script src="/static/forms/build/form_builder.js"></script>
  <script>

    var d3_updateable = function(target,selector,type,data,joiner) {
      var type = type || "div"
      var updateable = target.selectAll(selector).data(
        function(x){return data ? [data] : [x]},
        joiner || function(x){return [x]}
      )
    
      updateable.enter()
        .append(type)
    
      return updateable
    }
    
    var d3_splat = function(target,selector,type,data,joiner) {
      var type = type || "div"
      var updateable = target.selectAll(selector).data(
        data || function(x){return x},
        joiner || function(x){return x}
      )
    
      updateable.enter()
        .append(type)
    
      return updateable
    }

  </script>
  
</head>

<body style="width:1200px;margin-left:auto;margin-right:auto">
  <h4>Yo</h4>
  <div class="content">
  </div>
  <script>

    var fields = [
        {"type":"select","name":"yo", "values": ["a", "b"]}
      , {"type":"input","name":"yo2"}
      , {"type":"textarea","name":"yo3", "values": ["a", "b"]}
    ]

    var form = form_builder.forms(d3.select(".content"))
      .fields(fields)
      .on("click",function(d) { debugger })
      .draw()

    var addField = function(x) {

      var current = fields.reduce(function(p,z) { p[z.name] = true; return p},{})

      if (current[x.name] != true) fields.push(x)

      form.fields(fields)
        .draw()
      
    }

    d3_updateable(d3.select(".content"),".add-field","button")
      .classed("add-field",true)
      .on("click",function(){ addField({"name":"new","type":"select", "values":[]}) })

    
  </script>
</body>
