!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("d3")):"function"==typeof define&&define.amd?define("filter",["exports","d3"],n):n(t.filter=t.filter||{},t.d3)}(this,function(t,n){function e(t,n,e,i,r){var e=e||"div",o=t.selectAll(n).data(function(t){return i?[i]:[t]},r||function(t){return[t]});return o.enter().append(e),o}function i(t,n,e,i,r){var e=e||"div",o=t.selectAll(n).data(i||function(t){return t},r||function(t){return t});return o.enter().append(e),o}function r(t){this._target=t,this._data=!1,this._on={},this._render_op={},this._fields=[],this._ops=[]}function o(t){return new r(t)}function u(t,n){return void 0===n?this["_"+t]:(this["_"+t]=n,this)}function s(t){this._data=t,this._l="or"}function d(t){return new s(t)}n=n&&"default"in n?n.default:n;var f=function(){var t=0;return function(n,e){clearTimeout(t),t=setTimeout(n,e)}}();r.prototype={draw:function(){var t=e(this._target,".filters-wrapper","div",this.data(),function(){return 1}).classed("filters-wrapper",!0).style("padding-left","10px").style("padding-right","20px"),r=e(t,".filters","div",!1,function(t){return 1}).classed("filters",!0),o=i(r,".filter","div",function(t){return t},function(t,n){return n+t.field}).classed("filter",!0).style("line-height","33px");o.exit().remove();var u=this;return o.each(function(t,e){var i=n.select(this);u.filterRow(i,u._fields,u._ops,t)}),this.filterFooter(t),this},ops:function(t){return void 0===t?this._ops:(this._ops=t,this)},fields:function(t){return void 0===t?this._fields:(this._fields=t,this)},data:function(t){return void 0===t?this._data:(this._data=t,this)},text:function(t){return void 0===t?this._fn||function(t){return t.key}:(this._fn=t,this)},render_op:function(t,n){return void 0===n?this._render_op[t]||function(){}:(this._render_op[t]=n,this)},on:function(t,n){return void 0===n?this._on[t]||function(){}:(this._on[t]=n,this)},buildOp:function(t){var n=t.op,e=t.field,i=t.value;return[n,e,i].indexOf(void 0)>-1?function(){return!0}:this._ops[n](e,i)},filterRow:function(t,n,r,o){var u=this,s=(e(t,".remove","a").classed("remove",!0).style("float","right").style("font-weight","bold").html("&#10005;").on("click",function(t){var n=u.data().filter(function(n){return n!==t});u.data(n),u.draw(),u.on("update")(u.data())}),e(t,".inner","div").classed("inner",!0)),d=e(s,"select.field","select",n).classed("field",!0).style("width","165px").on("change",function(t,e){o.field=this.selectedOptions[0].__data__;var i=0;n.map(function(t,n){t==o.field&&(i=n)});var d=r[i].filter(function(t){return t.key==o.op});0==d.length&&(o.op=r[i][0].key),u.on("update")(u.data()),u.drawOps(s,r[i],o,i)});if(e(d,"option","option").property("disabled",!0).property("hidden",!0).text("Filter..."),i(d,"option","option").text(function(t){return t}).attr("selected",function(t){return t==o.field?"selected":void 0}),o.op&&o.field&&o.value){var f=n.indexOf(o.field);u.drawOps(s,r[f],o,f)}},drawOps:function(t,n,r){var o=this,u=e(t,"select.op","select",!1,function(t){return 1}).classed("op",!0).style("width","100px").style("margin-left","10px").style("margin-right","10px").on("change",function(n){r.op=this.selectedOptions[0].__data__.key,o.on("update")(o.data()),o.drawInput(t,r,r.op)}),s=n;r.op=r.op||s[0].key;var n=i(u,"option","option",s,function(t){return t.key}).text(function(t){return t.key.split(".")[0]}).attr("selected",function(t){return t.key==r.op?"selected":void 0});n.exit().remove(),o.drawInput(t,r,r.op)},drawInput:function(t,n,i){var r=this;t.selectAll(".value").remove();var o=this._render_op[i];return o?o.bind(this)(t,n):void e(t,"input.value","input").classed("value",!0).style("padding-left","10px").style("width","150px").style("line-height","1em").attr("value",n.value).on("keyup",function(t){var e=this;f(function(){n.value=e.value,r.on("update")(r.data())},1e3)})},filterFooter:function(t){var n=e(t,".filter-footer","div",!1,function(t){return 1}).classed("filter-footer",!0).style("margin-bottom","15px").style("margin-top","10px"),i=this;e(n,".add","a",!1,function(t){return 1}).classed("add",!0).style("font-weight","bold").html("&#65291;").style("width","24px").style("height","24px").style("line-height","24px").style("text-align","center").style("border-radius","15px").style("border","1.5px solid #428BCC").style("cursor","pointer").style("display","inline-block").on("click",function(t){var n=i._data;(0==n.length||Object.keys(n.slice(-1)).length>0)&&n.push({}),i.draw()})},typewatch:f},s.prototype={data:function(t){return u.bind(this)("data",t)},logic:function(t){return void 0==t?this._l:(this._l="and"==t?"and":"or",this)},op:function(t,n){return void 0===n?this._ops[t]||this._ops.equals:(this._ops[t]=n,this)},by:function(t){var n=this,e=function(e){if(0==t.length)return!0;var i=t.map(function(t){var i=t.field.split("."),r=i.slice(-1)[0],o=i.slice(0,-1).reduce(function(t,n){return t[n]},e),u=t.op.split("."),s=u[0];return n.op(s)(r,t.value)(o)}).filter(function(t){return t});return"and"==n._l?i.length==t.length:i.length>0};return this._data.filter(e)},on:function(t,n){return void 0===n?this._on[t]:(this._on[t]=n,this)},_ops:{equals:function(t,n){return function(e){return String(e[t])==String(n)}},"starts with":function(t,n){return function(e){return 0==String(e[t]).indexOf(String(n))}},"ends with":function(t,n){return function(e){return String(e[t]).length-String(n).length==String(e[t]).indexOf(String(n))}},"does not equal":function(t,n){return function(e){return String(e[t])!=String(n)}},"is set":function(t,n){return function(n){return void 0!=n[t]&&""!=n[t]}},"is not set":function(t,n){return function(n){return void 0==n[t]}},between:function(t,n){return function(e){return parseInt(e[t])>=n[0]&&parseInt(e[t])<=n[1]}},"is in":function(t,n){return function(e){var i=n.split(",");return i.reduce(function(n,i){return n+String(e[t]).indexOf(String(i))>-1},0)>0}},"is not in":function(t,n){return function(e){var i=n.split(",");return 0==i.reduce(function(n,i){return n+String(e[t]).indexOf(String(i))>-1},0)}},"does not contain":function(t,n){return function(e){var i=n.toLowerCase().split(",");return 0==i.reduce(function(n,i){return n+String(e[t]).indexOf(String(i).toLowerCase())>-1},0)}},contains:function(t,n){return function(e){var i=n.toLowerCase().split(",");return i.reduce(function(n,i){return n+String(e[t]).toLowerCase().indexOf(String(i).toLowerCase())>-1},0)>0}}}},t.default=o,t.filter=o,t.filter_data=d,Object.defineProperty(t,"__esModule",{value:!0})});