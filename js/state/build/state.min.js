!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?i(exports):"function"==typeof define&&define.amd?define("state",["exports"],i):i(t.state=t.state||{})}(this,function(t){"use strict";function i(t,i){this._noop=function(){},this._events={},this._on={change:this._noop,build:this._noop,forward:this._noop,back:this._noop},this._static=i||{},this._current=t||{},this._past=[],this._future=[],this._subscription={},this._state=this._buildState()}function n(t,n){return new i(t,n)}function s(t){this._encodeObject=function(t){return JSON.stringify(t)},this._encodeArray=function(t){return JSON.stringify(t)}}function e(t){for(var i,n={},s=(t+"").split(""),e=[],r=s[0],o=256,u=1;u<s.length;u++)i=s[u],null!=n[r+i]?r+=i:(e.push(r.length>1?n[r]:r.charCodeAt(0)),n[r+i]=o,o++,r=i);e.push(r.length>1?n[r]:r.charCodeAt(0));for(var u=0;u<e.length;u++)e[u]=String.fromCharCode(e[u]);return e.join("")}function r(t){for(var i,n={},s=(t+"").split(""),e=s[0],r=e,o=[e],u=256,c=1;c<s.length;c++){var h=s[c].charCodeAt(0);i=h<256?s[c]:n[h]?n[h]:r+e,o.push(i),e=i.charAt(0),n[u]=r+e,u++,r=i}return o.join("")}function o(t){return new s(t)}function u(t,i,n){return new d(t,i,n)}i.prototype={state:function(){return Object.assign({},this._state)},publish:function(t,i){var n=function(i,n){if(i)return subscriber(i,null);this.update(t,n),this.trigger(t,this.state()[t],this.state())}.bind(this);return"function"==typeof i?i(n):n(!1,i),this},publishBatch:function(t){Object.keys(t).map(function(i){this.update(i,t[i])}.bind(this)),this.triggerBatch(t,this.state())},push:function(t){return this.publish(!1,t),this},subscribe:function(){return"function"==typeof arguments[0]?this._global_subscribe(arguments[0]):-1==arguments[0].indexOf(".")?this._named_subscribe(arguments[0],arguments[1]):arguments[0].indexOf(".")>-1?this._targetted_subscribe(arguments[0].split(".")[0],arguments[0].split(".")[1],arguments[1]):void 0},unsubscribe:function(t){return this.subscribe(t,void 0),this},_global_subscribe:function(t){var i="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var i=16*Math.random()|0;return("x"==t?i:3&i|8).toString(16)});return this._targetted_subscribe(i,"*",t),this},_named_subscribe:function(t,i){return this._targetted_subscribe(t,"*",i),this},_targetted_subscribe:function(t,i,n){var s=this.get_subscribers_obj(i);this._state[i],this._state;return arguments.length<2&&void 0===n?s[t]||function(){}:void 0===n?(delete s[t],this):(s[t]=n,this)},get_subscribers_obj:function(t){return this._subscription[t]=this._subscription[t]||{},this._subscription[t]},get_subscribers_fn:function(t){var i=this.get_subscribers_obj(t),n=Object.keys(i).map(function(t){return i[t]});return function(t,i,s){return n.map(function(n){return n(t,i,s)})}},trigger:function(t,i,n){var s=this.get_subscribers_fn(t)||function(){},e=this.get_subscribers_fn("*")||function(){};this.on("change")(t,i,n),s(!1,i,n),e(!1,n)},triggerBatch:function(t,i){var n=this.get_subscribers_fn("*")||function(){};Object.keys(t).map(function(n){return(this.get_subscribers_fn||function(){}).bind(this)(n)(!1,t[n],i)}.bind(this));n(!1,i)},_buildState:function(){return this._state=Object.assign({},this._current),Object.keys(this._static).map(function(t){this._state[t]=this._static[t]}.bind(this)),this.on("build")(this._state,this._current,this._static),this._state},update:function(t,i){if(this._pastPush(this._current),t){var n={};n[t]=i}return this._current=t?Object.assign({},this._current,n):Object.assign({},this._current,i),this._buildState(),this},setStatic:function(t,i){return void 0!=t&&void 0!=i&&(this._static[t]=i),this._buildState(),this},publishStatic:function(t,i){var n=function(i,n){if(i)return subscriber(i,null);this._static[t]=n,this._buildState(),this.trigger(t,this.state()[t],this.state())}.bind(this);return"function"==typeof i?i(n):n(!1,i),this},_pastPush:function(t){this._past.push(t)},_futurePush:function(t){this._future.push(t)},forward:function(){this._pastPush(this._current),this._current=this._future.pop(),this.on("forward")(this._current,this._past,this._future),this._state=this._buildState(),this.trigger(!1,this._state,this._state)},back:function(){this._futurePush(this._current),this._current=this._past.pop(),this.on("back")(this._current,this._future,this._past),this._state=this._buildState(),this.trigger(!1,this._state,this._state)},on:function(t,i){return void 0===i?this._on[t]||this._noop:(this._on[t]=i,this)},registerEvent:function(t,i){return void 0===i?this._events[t]||this._noop:(this._events[t]=i,this)},prepareEvent:function(t){return this._events[t].bind(this)},dispatchEvent:function(t,i){return this.prepareEvent(t)(i),this}},n.prototype=i.prototype;var c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},h=function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")},a=function(){function t(t,i){for(var n=0;n<i.length;n++){var s=i[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(i,n,s){return n&&t(i.prototype,n),s&&t(i,s),i}}();s.prototype={to:function(t,i){var n=this,s=Object.keys(t).map(function(i){var s=t[i],e=s;return s&&"object"==(void 0===s?"undefined":c(s))&&s.length>0?e=n._encodeArray(s):"object"==(void 0===s?"undefined":c(s))&&(e=n._encodeObject(s)),i+"="+encodeURIComponent(e)});return i?"?encoded="+btoa(escape(e(s.join("&")))):"?"+s.join("&")},from:function(t){var i={};0==t.indexOf("?encoded=")&&(t=r(unescape(atob(t.split("?encoded=")[1]))));for(var n=t.substr(1).split("&"),s=0;s<n.length;s++){var e=n[s].split("=");i[decodeURIComponent(e[0])]=decodeURIComponent(e[1]||"");var o=i[decodeURIComponent(e[0])][0];"{"!=o&&"["!=o||(i[decodeURIComponent(e[0])]=JSON.parse(i[decodeURIComponent(e[0])]))}return i}},o.prototype=s.prototype;var f,_=function(t){},b=function(t,i){return t==i},p=function(t,i){return function(n,s){return i?s[t]:n[t]}},d=function(){function t(i,n,s){h(this,t),this._obj1=i,this._obj2=n,this._final=s,this._comparisons={}}return a(t,[{key:"accessor",value:function(t,i,n){return this._comparisons[t]=Object.assign({},this._comparisons[t],{acc1:i,acc2:n}),this}},{key:"success",value:function(t,i){return this._comparisons[t]=Object.assign({},this._comparisons[t],{success:i}),this}},{key:"failure",value:function(t,i){return this._comparisons[t]=Object.assign({},this._comparisons[t],{failure:i}),this}},{key:"equal",value:function(t,i){return this._comparisons[t]=Object.assign({},this._comparisons[t],{eq:i}),this}},{key:"evaluate",value:function(){var t=this;return Object.keys(this._comparisons).map(function(i){t._eval(t._comparisons[i],i)}),this._final}},{key:"comparsion",value:function(t,i,n,s,e,r){return this._comparisons[t]={acc1:i,acc2:n,eq:s||b,success:e||_,failure:r||_},this}},{key:"_eval",value:function(t,i){var n=t.acc1||p(i),s=t.acc2||p(i,!0),e=n(this._obj1,this._obj2),r=s(this._obj1,this._obj2),o=t.eq||b,u=t.success||_,c=t.failure||_;o(e,r)?u.bind(this)(e,r,this._final):c.bind(this)(e,r,this._final)}}]),t}();try{f=window.__state__||n()}catch(t){f=n()}var l=f;t.s=l,t.default=l,t.state=n,t.qs=o,t.comp_eval=u,Object.defineProperty(t,"__esModule",{value:!0})});