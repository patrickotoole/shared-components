!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("d3")):"function"==typeof define&&define.amd?define("table",["exports","d3"],t):t(e.table=e.table||{},e.d3)}(this,function(e,t){"use strict";function n(e,t){if("undefined"==typeof document)return t;e=e||"";var n=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");return r.type="text/css",n.appendChild(r),r.styleSheet?r.styleSheet.cssText=e:r.appendChild(document.createTextNode(e)),t}function r(e,t,n,r){return p(e,"."+t,n||"div",r).classed(t,!0)}function i(){}function s(e,t){return void 0===t?this["_"+e]:(this["_"+e]=t,this)}function o(e){this._wrapper_class="table-wrapper",this._target=e,this._data={},this._sort={},this._renderers={},this._top=0,this._default_renderer=function(e){return e.key.indexOf("percent")>-1?t.select(this).text(function(e){var n=this.parentNode.__data__;return t.format(".2%")(n[e.key]/100)}):t.select(this).text(function(e){var n=this.parentNode.__data__;return n[e.key]>0?t.format(",.2f")(n[e.key]).replace(".00",""):n[e.key]})},this._hidden_fields=[],this._on={},this._render_expand=function(e){if(t.select(this).selectAll("td.option-header").html("&ndash;"),this.nextSibling&&1==t.select(this.nextSibling).classed("expanded"))return t.select(this).selectAll("td.option-header").html("&#65291;"),t.select(this.parentNode).selectAll(".expanded").remove();t.select(this.parentNode).selectAll(".expanded").remove();var n=document.createElement("tr");this.parentNode.insertBefore(n,this.nextSibling);var r=t.select(n).classed("expanded",!0).datum({});return p(r,"td","td").attr("colspan",this.children.length)},this._render_header=function(e){e.each(function(e){var n=p(t.select(this),".headers","div").classed("headers",!0).style("text-transform","uppercase").style("font-weight","bold").style("line-height","24px").style("border-bottom","1px solid #ccc").style("margin-bottom","10px");n.html(""),p(n,".url","div").classed("url",!0).style("width","75%").style("display","inline-block").text("Article"),p(n,".count","div").classed("count",!0).style("width","25%").style("display","inline-block").text("Count")})},this._render_row=function(e){p(e,".url","div").classed("url",!0).style("width","75%").style("line-height","24px").style("height","24px").style("overflow","hidden").style("display","inline-block").text(function(e){return e.key}),p(e,".count","div").classed("count",!0).style("width","25%").style("display","inline-block").style("vertical-align","top").text(function(e){return e.value})}}function a(e){return new o(e)}function d(e){return new _(e)}t=t&&"default"in t?t.default:t;var l=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},h=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},u=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},p=function(e,t,n,r,i){var n=n||"div",s=e.selectAll(t).data(function(e){return r?[r]:[e]},i||function(e){return[e]});return s.enter().append(n),s},f=function(e,t,n,r,i){var n=n||"div",s=e.selectAll(t).data(r||function(e){return e},i||function(e){return e});return s.enter().append(n),s},y=function(){function e(t){var n=this;l(this,e),this._target=t,this._on={},this.props().map(function(e){n[e]=s.bind(n,e)})}return h(e,[{key:"props",value:function(){return["data"]}},{key:"on",value:function(e,t){return void 0===t?this._on[e]||i:(this._on[e]=t,this)}}]),e}();n(".table-wrapper tr { height:33px}\n.table-wrapper tr th { border-right:1px dotted #ccc } \n.table-wrapper tr th:last-of-type { border-right:none } \n\n.table-wrapper tr { border-bottom:1px solid #ddd }\n.table-wrapper tr th, .table-wrapper tr td { \n  padding-left:10px;\n  max-width:200px\n}\n\n.table-wrapper thead tr { \n  background-color:#e3ebf0;\n}\n.table-wrapper thead tr th .title { \n  text-transform:uppercase\n}\n.table-wrapper tbody tr { \n}\n.table-wrapper tbody tr:hover { \n  background-color:white;\n  background-color:#f9f9fb\n}\n",void 0),o.prototype={data:function(e){var t=s.bind(this)("data",e);if(e&&e.values.length&&void 0==this._headers){var n=Object.keys(e.values[0]).map(function(e){return{key:e,value:e}});this.headers(n)}return t},skip_option:function(e){return s.bind(this)("skip_option",e)},wrapper_class:function(e){return s.bind(this)("wrapper_class",e)},title:function(e){return s.bind(this)("title",e)},row:function(e){return s.bind(this)("render_row",e)},default_renderer:function(e){return s.bind(this)("default_renderer",e)},top:function(e){return s.bind(this)("top",e)},header:function(e){return s.bind(this)("render_header",e)},headers:function(e){return s.bind(this)("headers",e)},hidden_fields:function(e){return s.bind(this)("hidden_fields",e)},all_headers:function(){var e=this.headers().reduce(function(e,t){return e[t.key]=t.value,e},{}),t=this.headers().filter(function(e){return!!e.locked}).map(function(e){return e.key});if(this._data.values&&this._data.values.length){var n=Object.keys(this._data.values[0]).map(function(n){return!(this._hidden_fields&&this._hidden_fields.indexOf(n)>-1)&&{key:n,value:e[n]||n,selected:!!e[n],locked:t.indexOf(n)>-1||void 0}}.bind(this)).filter(function(e){return e}),r=function(e){return t.indexOf(e)>-1?t.indexOf(e)+10:0};return n=n.sort(function(e,t){return r(t.key||-1/0)-r(e.key||-1/0)})}return this.headers()},sort:function(e,t){return e?(this._sort={key:e,value:!!t},this):this._sort},render_wrapper:function(){var e=this._target,n=p(e,"."+this._wrapper_class,"div").classed(this._wrapper_class,!0).style("position","relative"),r=p(n,"table.main","table").classed("main",!0).style("width","100%");this._table_main=r;p(r,"thead","thead");p(r,"tbody","tbody");var i=p(n,"table.fixed","table").classed("hidden",!0).classed("fixed",!0).style("width",n.style("width")).style("top",this._top+"px").style("position","fixed"),s=this;try{t.select(window).on("scroll",function(){console.log(r.node().getBoundingClientRect().top,s._top),r.node().getBoundingClientRect().top<s._top?i.classed("hidden",!1):i.classed("hidden",!0);var n=[];e.selectAll(".main").selectAll(".table-headers").selectAll("th").each(function(e,t){n.push(this.offsetWidth)}),e.selectAll(".fixed").selectAll(".table-headers").selectAll("th").each(function(e,r){t.select(this).style("width",n[r]+"px")})})}catch(e){}this._table_fixed=i;p(i,"thead","thead");if(!this._skip_option){p(n,".table-option","a").classed("table-option",!0).style("position","absolute").style("top","-1px").style("right","0px").style("cursor","pointer").style("line-height","33px").style("font-weight","bold").style("padding-right","8px").style("padding-left","8px").text("OPTIONS").style("background","#e3ebf0").on("click",function(e){this._options_header.classed("hidden",!this._options_header.classed("hidden")),this._show_options=!this._options_header.classed("hidden")}.bind(this))}return n},render_header:function(e){var n=e.selectAll("thead"),r=e.selectAll("tbody");if(void 0!=this.headers()){var s=p(n,"tr.table-options","tr",this.all_headers(),function(e){return 1}).classed("hidden",!this._show_options).classed("table-options",!0),o=this._skip_option?this.headers():this.headers().concat([{key:"spacer",width:"70px"}]),a=p(n,"tr.table-headers","tr",o,function(e){return 1}).classed("table-headers",!0),d=f(a,"th","th",!1,function(e,t){return e.key+t}).style("width",function(e){return e.width}).style("position","relative").order(),l=function(e){e.sort===!1?(delete e.sort,this._sort={},this.draw()):(e.sort=!!e.sort,this.sort(e.key,e.sort),this.draw())}.bind(this);p(d,"span","span").classed("title",!0).style("cursor","pointer").text(function(e){return e.value}).on("click",this.on("sort")!=i?this.on("sort"):l),p(d,"i","i").style("padding-left","5px").classed("fa",!0).classed("fa-sort-asc",function(e){return e.key==this._sort.key?this._sort.value===!0:void 0}.bind(this)).classed("fa-sort-desc",function(e){return e.key==this._sort.key?this._sort.value===!1:void 0}.bind(this));var h=this,c=!0,u=t.behavior.drag().on("drag",function(e,n){var i=t.event.dx,s=parseInt(t.select(this.parentNode).style("width").replace("px"));this.parentNode.__data__.width=s+i+"px",t.select(this.parentNode).style("width",s+i+"px");var o=Array.prototype.slice.call(this.parentNode.parentNode.children,0).indexOf(this.parentNode)+1;t.select(this.parentNode.parentNode.children[o]).style("width",void 0),c&&(c=!1,setTimeout(function(){c=!0,r.selectAll("tr").selectAll("td:nth-of-type("+o+")").each(function(e){var t=h._renderers[e.key];t&&t.bind(this)(e)})},1))});p(d,"b","b").style("cursor","ew-resize").style("font-size","100%").style("height","100%").style("position","absolute").style("right","-8px").style("top","0").style("width","10px").style("z-index",1).on("mouseover",function(){var e=Array.prototype.slice.call(this.parentNode.parentNode.children,0).indexOf(this.parentNode)+1;r.selectAll("tr").selectAll("td:nth-of-type("+e+")").style("border-right","1px dotted #ccc")}).on("mouseout",function(){var e=Array.prototype.slice.call(this.parentNode.parentNode.children,0).indexOf(this.parentNode)+1;r.selectAll("tr").selectAll("td:nth-of-type("+e+")").style("border-right",void 0)}).call(u);if(d.exit().remove(),!this._skip_option){var y=p(s,"th","th",!1,function(){return 1}).attr("colspan",this.headers().length+1).style("padding-top","10px").style("padding-bottom","10px"),_=f(y,".option","div",!1,function(e){return e.key}).classed("option",!0).style("width","240px").style("display","inline-block");_.exit().remove();var h=this;p(_,"input","input").attr("type","checkbox").property("checked",function(e){return this.checked=e.selected,e.selected?"checked":void 0}).attr("disabled",function(e){return e.locked}).on("click",function(e){if(e.selected=this.checked,e.selected)return h.headers().push(e),h.draw();var t=h.headers().map(function(t,n){return t.key==e.key?n:void 0}),n=t.filter(function(e){return e})||0;h.headers().splice(n,1),h.draw()}),p(_,"span","span").text(function(e){return" "+e.value})}this._options_header=this._target.selectAll(".table-options")}},render_rows:function(e){var n=this,r=e.selectAll("tbody");if(void 0!=this.headers()&&this._data&&this._data.values&&this._data.values.length){var s=this._data.values,o=this._sort||{};s=s.sort(function(e,n){var r=e[o.key]||-1/0,i=n[o.key]||-1/0;return o.value?t.ascending(r,i):t.descending(r,i)});var a=f(r,"tr","tr",s,function(e,t){return String(o.key+e[o.key])+t}).order().on("click",function(e){if(n.on("expand")!=i){var t=n._render_expand.bind(this)(e);n.on("expand").bind(this)(e,t)}});a.exit().remove();f(a,"td","td",this.headers(),function(e,t){return e.key+t}).each(function(e){var r=(t.select(this),n._renderers[e.key]);if(r)return r.bind(this)(e);r=n._default_renderer.bind(this)(e)}).exit().remove();var d=p(a,"td.option-header","td",!1,function(){return 1}).classed("option-header",!0).style("width","70px").style("text-align","center");this._skip_option&&d.classed("hidden",!0),p(d,"a","a").style("font-weight","bold").html(n.option_text())}},option_text:function(e){return s.bind(this)("option_text",e)},render:function(e,t){return void 0==t?this._renderers[e]||!1:(this._renderers[e]=t,this)},draw:function(){var e=this;return this.render_wrapper().selectAll("table").each(function(n){e.render_header(t.select(this))}),this.render_rows(this._table_main),this.on("draw").bind(this)(),this},on:function(e,t){return void 0===t?this._on[e]||i:(this._on[e]=t,this)},d3:t},n(".summary-table { \n  display:inline-block;\n  vertical-align:top;\n}\n.summary-table > .title {\n  font-weight:bold;\n  font-size:14px;\n}\n\n.summary-table .wrap {\n  width:100%\n}\n",void 0);var _=function(e){function t(e){l(this,t);var n=u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n._wrapper_class="table-summary-wrapper",n}return c(t,e),h(t,[{key:"props",value:function(){return["title","headers","data","wrapper_class"]}},{key:"draw",value:function(){var e=r(this._target,"summary-table");r(e,"title").text(this.title()),a(r(e,"wrap")).wrapper_class(this.wrapper_class(),!0).data({values:this.data()}).skip_option(!0).headers(this.headers()).draw()}}]),t}(y);e.table=a,e.default=a,e.t=a,e.summary_table=d,Object.defineProperty(e,"__esModule",{value:!0})});